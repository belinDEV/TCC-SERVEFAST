<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Fechamento de Caixa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
</head>
<body class="bg-light">

<div th:replace="~{index :: navbar}"></div>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-cash-register me-3"></i>Fechamento de Caixa</h2>
        <div>
            <!-- BOTÕES DE FILTRO -->
            <a th:href="@{/caixa/fechamento(periodo='hoje')}" class="btn" th:classappend="${periodoSelecionado == 'hoje'} ? 'btn-primary' : 'btn-outline-primary'">Hoje</a>
            <a th:href="@{/caixa/fechamento(periodo='semana')}" class="btn" th:classappend="${periodoSelecionado == 'semana'} ? 'btn-primary' : 'btn-outline-primary'">Esta Semana</a>
            <a th:href="@{/caixa/fechamento(periodo='mes')}" class="btn" th:classappend="${periodoSelecionado == 'mes'} ? 'btn-primary' : 'btn-outline-primary'">Este Mês</a>
        </div>
    </div>

    <div class="row g-4">
        <!-- COLUNA ESQUERDA: RESUMO -->
        <div class="col-lg-4">
            <div class="card shadow-sm mb-4">
                <div class="card-header fw-bold d-flex justify-content-between align-items-center">
                    <span>Resumo Financeiro</span>
                    <!-- BOTÃO DE EXPORTAR PDF -->
                    <a th:href="@{/caixa/fechamento/pdf(periodo=${periodoSelecionado})}" class="btn btn-sm btn-danger" target="_blank">
                        <i class="fas fa-file-pdf me-2"></i>Exportar
                    </a>
                </div>
                <ul class="list-group list-group-flush">
                    <li th:each="forma : ${formasPagamento}" class="list-group-item d-flex justify-content-between align-items-center">
                        <span th:text="${forma.getDescricao()}"></span>
                        <span class="badge bg-primary rounded-pill fs-6"
                              th:text="${#numbers.formatCurrency(totaisPorFormaPagamento.getOrDefault(forma, 0.00))}">
                        </span>
                    </li>
                </ul>
                <div class="card-footer bg-dark text-white d-flex justify-content-between align-items-center">
                    <span class="fs-5">TOTAL GERAL</span>
                    <span class="fs-4 fw-bold" th:text="${#numbers.formatCurrency(totalGeral)}">R$ 0,00</span>
                </div>
            </div>
        </div>

        <!-- COLUNA DIREITA: HISTÓRICO DE PEDIDOS -->
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header fw-bold">Histórico de Pedidos do Período</div>
                <div class="card-body">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                        <tr>
                            <th>ID Pedido</th>
                            <th>Mesa</th>
                            <th>Data/Hora Fech.</th>
                            <th>Forma Pag.</th>
                            <th class="text-end">Valor</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="pedido : ${pedidos}">
                            <td th:text="${pedido.id}"></td>
                            <td th:text="${pedido.mesa.numero}"></td>
                            <td th:text="${#temporals.format(pedido.dataHoraFechamento, 'dd/MM HH:mm')}"></td>
                            <td><span class="badge bg-secondary" th:text="${pedido.formaPagamento?.getDescricao()}"></span></td>
                            <td class="text-end fw-bold" th:text="${#numbers.formatCurrency(pedido.valorTotal)}"></td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(pedidos)}">
                            <td colspan="5" class="text-center text-muted p-4">Nenhum pedido fechado no período selecionado.</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
